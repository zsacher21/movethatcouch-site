<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Marketing Materials • MOVE THAT COUCH!</title>

  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: #f7f7f7;
      color: #111;
    }

    header {
      background: #0f172a;
      color: white;
      padding: 18px 16px;
    }

    header a {
      color: white;
      text-decoration: none;
      font-weight: 600;
      opacity: 0.9;
    }

    header h1 {
      margin: 8px 0 0 0;
      font-size: 20px;
    }

    main {
      max-width: 900px;
      margin: 0 auto;
      padding: 18px 16px 40px;
    }

    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 1px 8px rgba(0,0,0,0.06);
      padding: 16px;
      margin-top: 14px;
    }

    label {
      display:block;
      font-weight:700;
      margin-bottom:8px;
    }

    input {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid #cbd5e1;
      font-size: 15px;
      box-sizing: border-box;
    }

    .row {
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      margin-top:12px;
    }

    button {
      border: 0;
      padding: 12px 14px;
      border-radius: 10px;
      font-weight: 800;
      font-size: 14px;
      cursor: pointer;
    }

    .btn-green { background:#22c55e; color:white; }
    .btn-blue { background:#2563eb; color:white; }
    .btn-gray { background:#475569; color:white; }

    .error {
      color:#b91c1c;
      font-weight:700;
      margin-top:10px;
      display:none;
    }

    .success {
      color:#166534;
      font-weight:700;
      margin-top:10px;
      display:none;
    }

    .greeting {
      margin-top:10px;
      font-weight:800;
      color:#0f172a;
      display:none;
    }

    .qrWrap {
      display:flex;
      gap:18px;
      flex-wrap:wrap;
      margin-top:12px;
      align-items:flex-start;
    }

    .qrBox {
      width: 280px;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 12px;
      text-align:center;
    }

    canvas {
      width: 240px;
      height: 240px;
      display:block;
      margin: 0 auto;
      background: white;
    }

    .small {
      font-size:12px;
      color:#475569;
      margin-top:8px;
      word-break:break-all;
    }

    .note {
      font-size:14px;
      color:#475569;
      line-height:1.35;
    }

    .divider {
      height:1px;
      background:#e2e8f0;
      margin:16px 0;
    }
  </style>
</head>

<body>

<header>
  <a href="/">← Home</a>
  <h1>Marketing Materials</h1>
</header>

<main>
  <div class="card">
    <label>Paste your referral link (or just the code)</label>
    <input id="refInput" placeholder="Example: V2Z9JE or https://app.movethatcouch.com/?ref=V2Z9JE">

    <div class="row">
      <button class="btn-green" id="generateBtn">Generate QR</button>
      <button class="btn-blue" id="copyBtn">Copy QR Link</button>
    </div>

    <div class="error" id="errorMsg"></div>
    <div class="success" id="successMsg"></div>
    <div class="greeting" id="greetingMsg"></div>

    <div class="qrWrap">
      <div class="qrBox">
        <canvas id="qrCanvas" width="240" height="240"></canvas>
        <div class="small" id="finalLink"></div>
      </div>

      <div style="flex:1;min-width:260px;">
        <div class="note">
          <b>How it works:</b> This page generates a QR code that points to your referral link.
          <div class="divider"></div>
          <b>Flyer format:</b><br>
          https://movethatcouch.com/r/&lt;CODE&gt;
        </div>
      </div>
    </div>
  </div>
</main>

<!-- EXACT library you already have -->
<script src="/assets/qrcode.min.js"></script>

<script>
  const canvas = document.getElementById("qrCanvas");
  const ctx = canvas.getContext("2d");
  const refInput = document.getElementById("refInput");
  const errorMsg = document.getElementById("errorMsg");
  const successMsg = document.getElementById("successMsg");
  const greetingMsg = document.getElementById("greetingMsg");
  const finalLink = document.getElementById("finalLink");

  const GENERIC = "https://movethatcouch.com";
  const BASE = "https://movethatcouch.com/r/";

  function showError(t){ errorMsg.textContent=t; errorMsg.style.display="block"; successMsg.style.display="none"; }
  function showSuccess(t){ successMsg.textContent=t; successMsg.style.display="block"; errorMsg.style.display="none"; }
  function clearMsgs(){ errorMsg.style.display="none"; successMsg.style.display="none"; greetingMsg.style.display="none"; }

  function extractCode(val){
    if(!val) return "";
    val = val.trim();
    if(/^[A-Za-z0-9]{4,20}$/.test(val)) return val;
    try{
      const u = new URL(val);
      return u.searchParams.get("ref") || "";
    }catch{ return ""; }
  }

  function drawQR(text){
    ctx.clearRect(0,0,240,240);

    if(typeof qrcode !== "function"){
      showError("QR library failed to load.");
      return;
    }

    const qr = qrcode(6, "L");
    qr.addData(text);
    qr.make();

    const cells = qr.getModuleCount();
    const tile = 240 / cells;

    ctx.fillStyle = "#fff";
    ctx.fillRect(0,0,240,240);
    ctx.fillStyle = "#000";

    for(let r=0;r<cells;r++){
      for(let c=0;c<cells;c++){
        if(qr.isDark(r,c)){
          ctx.fillRect(
            Math.floor(c*tile),
            Math.floor(r*tile),
            Math.ceil(tile),
            Math.ceil(tile)
          );
        }
      }
    }
  }

  function render(link){
    clearMsgs();
    finalLink.textContent = link;
    drawQR(link);
  }

  document.getElementById("generateBtn").onclick = () => {
    const code = extractCode(refInput.value);
    if(!code){
      render(GENERIC);
      showSuccess("Showing generic MOVE THAT COUCH! QR.");
      return;
    }
    const link = BASE + code;
    render(link);
    showSuccess("Personalized QR generated!");
  };

  document.getElementById("copyBtn").onclick = async () => {
    await navigator.clipboard.writeText(finalLink.textContent);
    showSuccess("QR link copied!");
  };

  // initial render
  render(GENERIC);
</script>

</body>
</html>
